version: '3.7'

services:
  test:
    image: rust:1.38
    volumes:
      - .:/cerk/
    working_dir: /cerk
    command: cargo test --all
  doc:
    image: rust:1.38
    volumes:
      - .:/cerk/
    working_dir: /cerk
    command: cargo doc --all
  check-readme:
    image: rust:1.38
    volumes:
      - .:/cerk/
    working_dir: /cerk
    command: 
      - /bin/bash 
      - -c
      - |
        cargo install cargo-readme && diff -q <(cargo readme  -r cerk) README.md || echo 1>&2 'Please update the README with `cargo readme -r cerk > README.md`' && exit -1
